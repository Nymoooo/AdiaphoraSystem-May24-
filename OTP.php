<?php

use PHPMailer\PHPMailer\PHPMailer;
use PHPMailer\PHPMailer\Exception;

require 'PHPMailer/src/Exception.php';
require 'PHPMailer/src/PHPMailer.php';
require 'PHPMailer/src/SMTP.php';

@include 'config.php';

$email = $_GET['Email'];
$nextLoc = $_GET['NextLocation'];

function generateOTP()
{
    $otp = '';
    $digits = '0123456789';
    $length = 6;

    for ($i = 0; $i < $length; $i++) {
        $otp .= $digits[rand(0, strlen($digits) - 1)];
    }

    return $otp;
}

function sendOTP($GENERATED_OTP)
{
    global $email;
    $MAILER = new PHPMailer(true);

    $MAILER->isSMTP();
    $MAILER->Host = "smtp.gmail.com";
    $MAILER->SMTPAuth = true;
    $MAILER->Username = "teamadiaphora@gmail.com";
    $MAILER->Password = "mgoyfgvwhkvlbkvh";
    $MAILER->Port = 465;
    $MAILER->setFrom("teamadiaphora@gmail.com");
    $MAILER->SMTPSecure = 'ssl';
    $MAILER->addAddress($email);
    $MAILER->isHTML(true);

    $MAILER->Subject = "Adiaphora Login OTP";
    $MAILER->Body = "<html lang='en'><head>     <meta charset='UTF-8'>     <meta http-equiv='X-UA-Compatible' content='IE=edge'>     <meta name='viewport' content='width=device-width, initial-scale=1.0'>     <title>Document</title>     <style>       .p-4 {         padding: 1rem;       }       .m-0 {         margin: 0;       }       .globalBg {         background-color: #f5f8fa;       }       .rounded-lg {         border-radius: 0.5rem;       }       .bg-white {         background-color: white;       }       .flex {         display: flex;       }       .inline-flex {         display: inline-flex;       }       .h-full {         height: 100%;       }       .h-screen {         height: 100vh;       }       .h-min {         height: min-content;       }       .h-max {         height: max-content;       }       .h-fit {         height: fit-content;       }     </style>   </head>   <body>     <div>       <div></div>       <div tabindex='-1'></div>       <div>         <div>           <u></u>           <div style='word-spacing: normal; background-color: #ffffff'>             <span style='                 display: none;                 font-size: 1px;                 color: #333333;                 line-height: 1px;                 max-height: 0px;                 max-width: 0px;                 opacity: 0;                 overflow: hidden;               '>Adiaphora System             </span>             <div style='display: none; max-height: 0px; overflow: hidden'>               &zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;<wbr>&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;&zwnj;&nbsp;             </div>             <div style='background-color: #ffffff'>               <div style='margin: 0px auto; max-width: 600px'>                 <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='width: 100%'>                   <tbody>                     <tr>                       <td style='                           direction: ltr;                           font-size: 0px;                           padding: 8px;                           padding-bottom: 0px;                           padding-left: 8px;                           padding-right: 8px;                           padding-top: 0px;                           text-align: center;                         '>                         <div style='                             font-size: 0px;                             text-align: left;                             direction: ltr;                             display: inline-block;                             vertical-align: top;                             width: 100%;                           '>                           <table border='0' cellpadding='0' cellspacing='0' role='presentation' width='100%'>                             <tbody>                               <tr>                                 <td style='vertical-align: top; padding: 0'>                                   <table border='0' cellpadding='0' cellspacing='0' role='presentation' width='100%'>                                     <tbody>                                       <tr>                                         <td align='center' style='                                             font-size: 0px;                                             padding: 0px;                                             padding-top: 40px;                                             padding-right: 0px;                                             padding-bottom: 16px;                                             padding-left: 0px;                                             word-break: break-word;                                           '>                                           <table border='0' cellpadding='0' cellspacing='0' role='presentation' style='                                               border-collapse: collapse;                                               border-spacing: 0px;                                             '>                                             <tbody>                                               <tr>                                                 <td style='width: 108px'>                                                                                                  </td>                                               </tr> <tr>                                                 <td style='width: 108px'>                                                   <a target='_blank' ><img alt='AdiaphoraLogo' height='auto' src='https://media.discordapp.net/attachments/1040843356441423882/1079197743056175295/delivered-removebg-preview.png?width=488&amp;height=391' style='                                                         border: 0;                                                         display: block;                                                         outline: none;                                                         text-decoration: none;                                                         height: auto;                                                         width: 200px;                                                         font-size: 13px;                                                       margin-top:50px' width='108'></a>                                                 </td>                                               </tr>                                            </tbody>                                           </table>                                         </td>                                       </tr>                                       <tr>                                         <td align='left' style='                                             font-size: 0px;                                             padding: 10px;                                             padding-top: 32px;                                             padding-right: 12px;                                             padding-bottom: 0px;                                             padding-left: 10px;                                             word-break: break-word;                                             display: none;                                           '>                                           <div style='                                               font-family: Helvetica, Arial,                                                 sans-serif;                                               font-size: 20px;                                               line-height: 1.3;                                               text-align: left;                                               color: #0d0c22;                                             '>                                             <strong>Adiaphora</strong><br><strong></strong>                                           </div>                                         </td>                                       </tr>                                     </tbody>                                   </table>                                 </td>                               </tr>                             </tbody>                           </table>                         </div>                       </td>                     </tr>                   </tbody>                 </table>               </div>               <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='                   background: #ffffff;                   background-color: #ffffff;                   width: 100%;                 '>                 <tbody>                   <tr>                     <td>                       <div style='margin: 0px auto; max-width: 600px'>                         <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='width: 100%'>                           <tbody>                             <tr>                               <td style='                                   direction: ltr;                                   font-size: 0px;                                   padding: 20px;                                   text-align: center;                                 '>                                 <div style='                                     font-size: 0px;                                     text-align: left;                                     direction: ltr;                                     display: inline-block;                                     vertical-align: top;                                     width: 100%;                                   '>                                   <table border='0' cellpadding='0' cellspacing='0' role='presentation' width='100%'>                                     <tbody>                                       <tr>                                         <td style='                                             vertical-align: top;                                             padding: 0;                                           '>                                           <table border='0' cellpadding='0' cellspacing='0' role='presentation' width='100%'>                                             <tbody>                                               <tr>                                                 <td align='center' style='                                                     font-size: 0px;                                                     padding: 0px;                                                     word-break: break-word;                                                   '>                                                   <table border='0' cellpadding='0' cellspacing='0' role='presentation' style='                                                       border-collapse: collapse;                                                       border-spacing: 0px;                                                     '>                                                     <tbody>                                                     </tbody>                                                   </table>                                                 </td>                                               </tr>                                             </tbody>                                           </table>                                         </td>                                       </tr>                                     </tbody>                                   </table>                                 </div>                               </td>                             </tr>                           </tbody>                         </table>                       </div>                     </td>                   </tr>                 </tbody>               </table>               <div style='margin: 0px auto; max-width: 600px'>                 <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='width: 100%'>                   <tbody>                     <tr>                       <td style='                           direction: ltr;                           font-size: 0px;                           padding: 20px;                           padding-bottom: 16px;                           padding-left: 20px;                           padding-right: 20px;                           padding-top: 8px;                           text-align: center;                         '>                         <div style='                             font-size: 0px;                             text-align: left;                             direction: ltr;                             display: inline-block;                             vertical-align: top;                             width: 100%;                           '>                           <table border='0' cellpadding='0' cellspacing='0' role='presentation' width='100%'>                             <tbody>                               <tr>                                 <td style='vertical-align: top; padding: 0'>                                   <table border='0' cellpadding='0' cellspacing='0' role='presentation' width='100%'>                                     <tbody>                                       <tr>                                         <td align='left' style='                                             font-size: 0px;                                             padding: 0px;                                             padding-top: 0px;                                             padding-right: 0px;                                             padding-bottom: 0px;                                             padding-left: 0px;                                             word-break: break-word;                                           '>                                           <div style='                                               font-family: Helvetica, Arial,                                                 sans-serif;                                               font-size: 16px;                                               line-height: 1.5;                                               text-align: left;                                               color: #0d0c22;                                             '>                                             <p style='text-align: center'>                                             <span style='font-size: 16px;'><strong>Hi! </strong> Here is your OTP <strong><i>{$GENERATED_OTP}</i></strong><br> </span> <br><span style='font-size: 14px; color:rgb(89, 89, 89)'>Do you have any questions? You                                                 can email us                                                 <a href='mailto:teamadiaphora@gmail.com' target='_blank'>teamadiaphora@gmail.com</a>.</span>                                             </p>                                           </div>                                         </td>                                       </tr>                                     </tbody>                                   </table>                                 </td>                               </tr>                             </tbody>                           </table>                         </div>                       </td>                     </tr>                   </tbody>                 </table>               </div>               <div style='margin: 0px auto; max-width: 600px'>                 <table align='center' border='0' cellpadding='0' cellspacing='0' role='presentation' style='width: 100%'>                   <tbody>                     <tr>                       <td style='                           direction: ltr;                           font-size: 0px;                           padding: 20px;                           padding-bottom: 24px;                           padding-left: 8px;                           padding-right: 8px;                           padding-top: 50px;                           text-align: center;                         '>                         <div style='                             font-size: 0px;                             text-align: left;                             direction: ltr;                             display: inline-block;                             vertical-align: top;                             width: 100%;                           '>                           <table border='0' cellpadding='0' cellspacing='0' role='presentation' width='100%'>                             <tbody>                               <tr>                                 <td style='vertical-align: top; padding: 0'>                                   <table border='0' cellpadding='0' cellspacing='0' role='presentation' width='100%'>                                     <tbody>                                       <tr>                                         <td align='center' style='                                             font-size: 0px;                                             padding: 10px;                                             word-break: break-word;                                           '>                                           </div>                                         </td>                                       </tr>                                     </tbody>                                   </table>                                 </td>                               </tr>                             </tbody>                           </table>                         </div>                       </td>                     </tr>                   </tbody>                 </table>               </div>             </div>             <img width='1px' height='1px' alt=''>           </div>           <div></div>           <div></div>         </div>       </div>       <div style='display: none'>         <div></div>       </div>       <div></div>     </div><!-- Code injected by live-server --></body></html>";

    $MAILER->send();
}

$OTP = generateOTP();
sendOTP($OTP);

var_dump($OTP);
?>


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP</title>
    <!-- custom css file link  -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="form-container">
        <form>
            <h3>OTP Confirmation</h3>
            <img src="images/aslogo.png">
            <span id="error-msg" style="color: crimson; font-size: 20px;  margin:10px 0;"></span>
            <input type="text" id="otp-input" name="otp-code" required placeholder="Enter 6 Digit OTP">
            <input onclick="verifyOTP()" type="button" style="text-align:center" name="submit" value="Verify OTP" class="form-btn">
            <p>Did not recieve? <a href="OTP.php?Email=<?= $email ?>&NextLocation=<?= $nextLoc ?>">Resend OTP</a></p>
        </form>
        <script>
            const OTP = "<?= $OTP ?>";

            function verifyOTP() {
                document.getElementById("error-msg").innerText = "";
                var OtpInput = document.getElementById("otp-input");
                if (OTP === OtpInput.value) window.location.href = "<?= $nextLoc ?>";
                else document.getElementById("error-msg").innerText = "Wrong OTP";
            }
        </script>
    </div>
</body>

</html>